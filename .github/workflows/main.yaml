name: ci
on:
  push:
    branches: main

jobs:
  build:
    name: ""
    runs-on: ubuntu-latest
    steps:
      - name: ":hammer_and_wrench:"
        uses: actions/checkout@v2
      - name: check gh
        env:
          GITHUB_TOKEN: ${{ secrets.REMOTE_GITHUB_TOKEN }}
          GH_ORG: "tjololo"
          GH_REPO: "az-static-webapp"
        run: |
          #gh auth login
          AUTHOR_EMAIL=$(git log -1 | grep Author | cut -d' ' -f3 | cut -d'<' -f2 | cut -d'>' -f1)
          gh repo clone $GH_ORG/$GH_REPO
          cd $GH_REPO
          git checkout preview
          git pull
          cp ../html/index.html .
          cp ../img/* ./img/
          git config user.email "$AUTHOR_EMAIL"
          git config user.name "$GITHUB_ACTOR"
          git add .
          git commit -m "Update based on $GITHUB_SHA"
          git push origin preview
          gh pr create -t "Update based on $GITHUB_SHA" -b "Update based on $GITHUB_SHA" -b "main"
          rm -f token.txt

